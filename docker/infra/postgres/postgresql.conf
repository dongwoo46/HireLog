# ==========================================================
# PostgreSQL Main Configuration
# HireLog - SCRAM + CDC + External Access
# ==========================================================

# ----------------------------------------------------------
# FILE LOCATIONS
# ----------------------------------------------------------

# pg_hba.conf 경로 명시 (Docker bind mount)
hba_file = '/etc/postgresql/pg_hba.conf'

# ----------------------------------------------------------
# CONNECTION
# ----------------------------------------------------------

listen_addresses = '*'
port = 5432
max_connections = 200

# SCRAM encryption 기본값
password_encryption = scram-sha-256

# ----------------------------------------------------------
# WAL / CDC (Debezium 필수)
# ----------------------------------------------------------

wal_level = logical
max_wal_senders = 10
max_replication_slots = 10
wal_keep_size = 512MB

# ----------------------------------------------------------
# MEMORY (OCI 4~8GB 기준 Dev)
# ----------------------------------------------------------

shared_buffers = 512MB
work_mem = 16MB
maintenance_work_mem = 128MB
effective_cache_size = 1GB

# ----------------------------------------------------------
# LOGGING
# ----------------------------------------------------------

logging_collector = on
log_destination = 'stderr'
log_min_duration_statement = 1000
log_connections = on
log_disconnections = on
log_statement = 'ddl'

# ----------------------------------------------------------
# PERFORMANCE
# ----------------------------------------------------------

synchronous_commit = on
checkpoint_completion_target = 0.9
random_page_cost = 1.1
effective_io_concurrency = 200

# ----------------------------------------------------------
# SECURITY
# ----------------------------------------------------------

ssl = off  # 현재는 SCRAM만 사용 (TLS는 별도 설정 필요)
